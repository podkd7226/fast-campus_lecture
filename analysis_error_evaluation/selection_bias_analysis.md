# ğŸ¯ ì„ íƒ í¸í–¥ ë¶„ì„: 21ê°œ vs 98ê°œ ê²€ì‚¬ ì„ íƒì˜ ì˜í–¥

## ğŸ“Œ ìš”ì•½

**"ê°€ì¥ í”í•œ" 21ê°œ ê²€ì‚¬ë§Œ ì„ íƒí•œ ê²°ê³¼**
- ì‚¬ë§ë¥  ì™œê³¡: 36.5% (ì˜ëª») vs 25.0% (ì‹¤ì œ)
- í™˜ìêµ° í¸í–¥: ì¤‘ì¦ í™˜ì ê³¼ëŒ€ ëŒ€í‘œ
- ëª¨ë¸ ì¼ë°˜í™” ë¶ˆê°€ëŠ¥

---

## 1. ì„ íƒ í¸í–¥ì´ë€?

### 1.1 ì •ì˜
**Selection Bias**: ë¶„ì„ ëŒ€ìƒì„ ì˜ëª» ì„ íƒí•˜ì—¬ ì „ì²´ ëª¨ì§‘ë‹¨ì„ ëŒ€í‘œí•˜ì§€ ëª»í•˜ëŠ” ì˜¤ë¥˜

### 1.2 ì´ë²ˆ ì‚¬ë¡€
```
ì „ì²´ 1,200ëª… í™˜ì
    â†“
"í”í•œ" 21ê°œ ê²€ì‚¬ë§Œ ì„ íƒ
    â†“
427ëª…ë§Œ ë¶„ì„ (35.6%)
    â†“
ë‚˜ë¨¸ì§€ 773ëª… (64.4%) ë¬´ì‹œ
```

**ë¬¸ì œ**: 427ëª…ì´ ì „ì²´ 1,200ëª…ì„ ëŒ€í‘œí•œë‹¤ê³  ê°€ì •

---

## 2. 21ê°œ ê²€ì‚¬ ì„ íƒì˜ ë¬¸ì œ

### 2.1 ì„ íƒ ê¸°ì¤€ì˜ ì˜¤ë¥˜

```python
# extract_admission_day_labs.py 18-45ì¤„
COMMON_LAB_ITEMS = {
    # Basic Metabolic Panel (8ê°œ)
    50983: 'Sodium',
    50971: 'Potassium',
    # ... 
    
    # Complete Blood Count (9ê°œ)
    51222: 'Hemoglobin',
    51221: 'Hematocrit',
    # ...
    
    # Other Common Tests (3ê°œ)
    50893: 'Calcium_Total',
    50960: 'Magnesium',
    50970: 'Phosphate'
}
```

**ì„ íƒ ë…¼ë¦¬**: "ê°€ì¥ í”í•œ ê²€ì‚¬" = "ê°€ì¥ ì¤‘ìš”í•œ ê²€ì‚¬"? âŒ

### 2.2 ì œì™¸ëœ ì¤‘ìš” ê²€ì‚¬ë“¤

| ê²€ì‚¬ ì¹´í…Œê³ ë¦¬ | ì œì™¸ëœ ê²€ì‚¬ | ì„ìƒì  ì¤‘ìš”ë„ | ì˜í–¥ |
|--------------|------------|--------------|------|
| ì‘ê³  ê²€ì‚¬ | PT, PTT, D-Dimer | ìˆ˜ìˆ /ì¶œí˜ˆ í‰ê°€ í•„ìˆ˜ | ìˆ˜ìˆ  í™˜ì ëˆ„ë½ |
| ê°„ê¸°ëŠ¥ | Albumin, Bilirubin, AST, ALT | ê°„ë¶€ì „ í‰ê°€ | ê°„ì§ˆí™˜ í™˜ì ëˆ„ë½ |
| ì‹¬ì¥ í‘œì§€ì | Troponin, NTproBNP | ì‹¬ê·¼ê²½ìƒ‰/ì‹¬ë¶€ì „ ì§„ë‹¨ | ì‹¬ì¥ í™˜ì ëˆ„ë½ |
| ê°ì—¼ ì§€í‘œ | Lactate, CRP, Procalcitonin | íŒ¨í˜ˆì¦ í‰ê°€ | ì¤‘ì¦ ê°ì—¼ ëˆ„ë½ |
| ì‹ ì¥ ê¸°ëŠ¥ | eGFR, Cystatin C | ì‹ ë¶€ì „ ì •ë„ | ì‹ ì¥ í™˜ì ëˆ„ë½ |

---

## 3. ì„ íƒ í¸í–¥ì˜ ì‹¤ì œ ì˜í–¥

### 3.1 í™˜ìêµ° íŠ¹ì„± ë¹„êµ

| íŠ¹ì„± | 21ê°œ ê²€ì‚¬ (427ëª…) | 98ê°œ ê²€ì‚¬ (1,200ëª…) | ì°¨ì´ |
|------|------------------|-------------------|------|
| **í¬í•¨ ë¹„ìœ¨** | 35.6% | 100% | -64.4% |
| **ì‚¬ë§ë¥ ** | 36.5% (156/427) | 25.0% (300/1200) | +11.5%p |
| **í‰ê·  ê²€ì‚¬ ìˆ˜** | 17.1ê°œ | 13.7ê°œ | +3.4ê°œ |
| **ICU ì…ì›ìœ¨** | ì¶”ì • 60% | ì¶”ì • 40% | +20%p |

### 3.2 ì‚¬ë§ë¥  ì™œê³¡ ë¶„ì„

```python
# ì‹¤ì œ ë°ì´í„° ê¸°ë°˜ ê³„ì‚°
ì „ì²´ 1,200ëª… ì¤‘ ì‚¬ë§: 300ëª… (25.0%)

# 21ê°œ ê²€ì‚¬ ê·¸ë£¹ (427ëª…)
- ì‚¬ë§: 156ëª… (36.5%)
- ìƒì¡´: 271ëª…

# ì œì™¸ëœ ê·¸ë£¹ (773ëª…)
- ì‚¬ë§: 144ëª… (18.6%)  # 300 - 156
- ìƒì¡´: 629ëª…

# ê²°ë¡ : ì œì™¸ëœ ê·¸ë£¹ì˜ ì‚¬ë§ë¥ ì´ í›¨ì”¬ ë‚®ìŒ
```

**í•´ì„**: 
- 21ê°œ ê²€ì‚¬ë¥¼ ë§ì´ í•œ í™˜ì = ë” ì•„í”ˆ í™˜ì
- ê²€ì‚¬ë¥¼ ì ê²Œ í•œ í™˜ì = ìƒëŒ€ì ìœ¼ë¡œ ê±´ê°•í•œ í™˜ì
- **Berkson's Bias** ë°œìƒ

---

## 4. 98ê°œ ê²€ì‚¬ (inclusion=1) ì ‘ê·¼ë²•

### 4.1 ì˜¬ë°”ë¥¸ ì„ íƒ ê¸°ì¤€

```python
# extract_initial_labs_complete.py 30-31ì¤„
inclusion_df = pd.read_csv('d_labitems_inclusion.csv')
included_labs = inclusion_df[inclusion_df['inclusion'] == 1]
# ì „ë¬¸ê°€ê°€ ì„ ë³„í•œ 87-98ê°œ ê²€ì‚¬ ì‚¬ìš©
```

**ì¥ì **:
- ë„ë©”ì¸ ì „ë¬¸ê°€ì˜ íŒë‹¨ ë°˜ì˜
- ì²´ê³„ì  ì„ íƒ (inclusion í”Œë˜ê·¸)
- ì¬í˜„ ê°€ëŠ¥ì„±

### 4.2 ì»¤ë²„ë¦¬ì§€ ë¹„êµ

| ê²€ì‚¬ ìœ í˜• | 21ê°œ ê²€ì‚¬ | 98ê°œ ê²€ì‚¬ | ê°œì„  |
|-----------|-----------|-----------|------|
| ê¸°ë³¸ ëŒ€ì‚¬ | âœ… 8/8 | âœ… 8/8 | - |
| í˜ˆì•¡í•™ | âœ… 9/9 | âœ… 9/9 | - |
| ì‘ê³  | âŒ 0/3 | âœ… 3/3 | +3 |
| ê°„ê¸°ëŠ¥ | âŒ 0/5 | âœ… 5/5 | +5 |
| ì‹¬ì¥ | âŒ 0/3 | âœ… 3/3 | +3 |
| ê°ì—¼ | âŒ 0/4 | âœ… 4/4 | +4 |
| **ì „ì²´** | **21ê°œ** | **98ê°œ** | **+77ê°œ** |

---

## 5. ë¨¸ì‹ ëŸ¬ë‹ ëª¨ë¸ì— ë¯¸ì¹˜ëŠ” ì˜í–¥

### 5.1 í›ˆë ¨ ë°ì´í„° í¸í–¥

```python
# ì˜ëª»ëœ ëª¨ë¸ (21ê°œ ê²€ì‚¬, 427ëª…)
model_biased = train_model(X_427, y_427)
# íŠ¹ì§•: ì¤‘ì¦ í™˜ìì— ê³¼ì í•©
# ë¬¸ì œ: ê²½ì¦ í™˜ì ì˜ˆì¸¡ ì‹¤íŒ¨

# ì˜¬ë°”ë¥¸ ëª¨ë¸ (98ê°œ ê²€ì‚¬, 1,200ëª…)  
model_correct = train_model(X_1200, y_1200)
# íŠ¹ì§•: ì „ì²´ ìŠ¤í™íŠ¸ëŸ¼ í•™ìŠµ
# ì¥ì : ì¼ë°˜í™” ê°€ëŠ¥
```

### 5.2 ì˜ˆì¸¡ ì„±ëŠ¥ ì°¨ì´ (ì¶”ì •)

| ëª¨ë¸ | í›ˆë ¨ AUC | í…ŒìŠ¤íŠ¸ AUC | ì¼ë°˜í™” |
|------|----------|------------|--------|
| 21ê°œ ê²€ì‚¬ ëª¨ë¸ | 0.85 | 0.65 | ì‹¤íŒ¨ |
| 98ê°œ ê²€ì‚¬ ëª¨ë¸ | 0.80 | 0.78 | ì„±ê³µ |

**ì´ìœ **: ê³¼ì í•© vs ì ì ˆí•œ í•™ìŠµ

---

## 6. ìƒì¡´ì í¸í–¥ ì¶”ê°€ ë¶„ì„

### 6.1 ê²€ì‚¬ë¥¼ ì•ˆ í•œ ì´ìœ 

773ëª…ì´ 21ê°œ ê¸°ë³¸ ê²€ì‚¬ë¥¼ ì•ˆ í•œ ì´ìœ :

| ì´ìœ  | ì¶”ì • ë¹„ìœ¨ | ì˜ˆì‹œ |
|------|-----------|------|
| **ë„ˆë¬´ ê±´ê°•** | 30% | ë‹¨ìˆœ ê³¨ì ˆ, ê²½ë¯¸í•œ ìˆ˜ìˆ  |
| **ë„ˆë¬´ ìœ„ê¸‰** | 20% | ì¦‰ì‹œ ìˆ˜ìˆ , CPR ìƒí™© |
| **íŠ¹ìˆ˜ ê²€ì‚¬ë§Œ** | 25% | ì‹¬ì¥ í™˜ì (Troponinë§Œ) |
| **ì™¸ë¶€ ê²€ì‚¬** | 15% | ì „ì› í™˜ì |
| **ê¸°íƒ€** | 10% | DNR, í˜¸ìŠ¤í”¼ìŠ¤ |

### 6.2 Missing Not At Random (MNAR)

```
ê²€ì‚¬ ë¯¸ì‹œí–‰ â‰  ëœë¤
ê²€ì‚¬ ë¯¸ì‹œí–‰ = ì„ìƒì  ê²°ì •

ë”°ë¼ì„œ:
- Missing Completely At Random (MCAR) âŒ
- Missing At Random (MAR) âŒ  
- Missing Not At Random (MNAR) âœ…
```

**í•¨ì˜**: ë‹¨ìˆœ ì œì™¸ ì‹œ ì‹¬ê°í•œ í¸í–¥ ë°œìƒ

---

## 7. ì˜¬ë°”ë¥¸ ì ‘ê·¼ë²•

### 7.1 ì „ì²´ í¬í•¨ ì›ì¹™

```python
# âŒ ì˜ëª»ëœ ì ‘ê·¼
df_with_labs = df[df['has_any_lab'] == True]
# 773ëª… ì œì™¸ â†’ í¸í–¥

# âœ… ì˜¬ë°”ë¥¸ ì ‘ê·¼
df_all = df.copy()  # 1,200ëª… ëª¨ë‘ ìœ ì§€
df_all['has_any_lab'] = check_labs(df_all)
df_all['n_labs'] = count_labs(df_all)
# ê²€ì‚¬ ì—¬ë¶€ë„ íŠ¹ì§•ìœ¼ë¡œ í™œìš©
```

### 7.2 ê²°ì¸¡ê°’ ì²˜ë¦¬ ì „ëµ

```python
# 1. ì§€ì‹œì ë³€ìˆ˜ ì¶”ê°€
df['lab_missing'] = df['lab_value'].isna()

# 2. ì¡°ê±´ë¶€ ëŒ€ì²´
df.loc[df['lab_missing'], 'lab_value'] = population_median

# 3. ë‹¤ì¤‘ ëŒ€ì²´ (Multiple Imputation)
from sklearn.impute import IterativeImputer
imputer = IterativeImputer()
df_imputed = imputer.fit_transform(df)
```

---

## 8. ì²´í¬ë¦¬ìŠ¤íŠ¸ ë° ê¶Œì¥ì‚¬í•­

### âœ… ì„ íƒ í¸í–¥ ì˜ˆë°© ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] **í¬í•¨ ê¸°ì¤€ ëª…í™•í™”**
  - [ ] ë„ë©”ì¸ ì „ë¬¸ê°€ ê²€í† 
  - [ ] ë¬¸í—Œ ê¸°ë°˜ ê·¼ê±°
  - [ ] ì¬í˜„ ê°€ëŠ¥í•œ ì •ì˜
  
- [ ] **ì œì™¸ ì˜í–¥ í‰ê°€**
  - [ ] ì œì™¸ëœ ìƒ˜í”Œ ìˆ˜ì™€ ë¹„ìœ¨
  - [ ] ì œì™¸ëœ ìƒ˜í”Œì˜ íŠ¹ì„±
  - [ ] ì œì™¸ ì´ìœ  ë¬¸ì„œí™”
  
- [ ] **ëŒ€í‘œì„± ê²€ì¦**
  - [ ] í¬í•¨ ìƒ˜í”Œ vs ì „ì²´ ëª¨ì§‘ë‹¨ ë¹„êµ
  - [ ] ì£¼ìš” ë³€ìˆ˜ ë¶„í¬ ë¹„êµ
  - [ ] ê²°ê³¼ ë³€ìˆ˜ ë¹„êµ
  
- [ ] **ë¯¼ê°ë„ ë¶„ì„**
  - [ ] ë‹¤ì–‘í•œ í¬í•¨ ê¸°ì¤€ìœ¼ë¡œ ì¬ë¶„ì„
  - [ ] ê²°ê³¼ì˜ robustì„± í™•ì¸

### ğŸ’¡ Best Practice

1. **ì‹œì‘ì€ ì „ì²´ ë°ì´í„°ë¡œ**
   ```python
   df_all = load_all_data()  # 1,200ëª…
   df_filtered = apply_criteria(df_all)
   print(f"ì œì™¸: {len(df_all) - len(df_filtered)}ëª…")
   ```

2. **ì œì™¸ ì´ìœ  ì¶”ì **
   ```python
   df_all['excluded'] = False
   df_all['exclusion_reason'] = None
   df_all.loc[condition, 'excluded'] = True
   df_all.loc[condition, 'exclusion_reason'] = 'No labs'
   ```

3. **ì˜í–¥ ë¶„ì„**
   ```python
   compare_groups(
       included=df_filtered,
       excluded=df_all[df_all['excluded']]
   )
   ```

---

## 9. ê²°ë¡ 

### í•µì‹¬ êµí›ˆ

> **"ë°ì´í„°ê°€ ì—†ëŠ” ê²ƒë„ ë°ì´í„°ë‹¤"**
> 
> ê²€ì‚¬ë¥¼ ì•ˆ í•œ 773ëª…ì„ ë¬´ì‹œí•˜ë©´,  
> ê²€ì‚¬ë¥¼ ë§ì´ í•œ 427ëª…ë§Œì˜ ì´ì•¼ê¸°ê°€ ëœë‹¤.

### ì‹¤ë¬´ ê¶Œì¥ì‚¬í•­

1. **í•˜ë“œì½”ë”© ê¸ˆì§€**: 21ê°œ ê²€ì‚¬ ê°™ì€ ìì˜ì  ì„ íƒ í”¼í•˜ê¸°
2. **ë„ë©”ì¸ ì§€ì‹ í™œìš©**: inclusion í”Œë˜ê·¸ ê°™ì€ ì „ë¬¸ê°€ íŒë‹¨ í™œìš©
3. **ì „ì²´ ìœ ì§€**: ê°€ëŠ¥í•œ ëª¨ë“  ìƒ˜í”Œ í¬í•¨
4. **íˆ¬ëª…ì„±**: ì œì™¸ ê¸°ì¤€ê³¼ ì˜í–¥ ëª…ì‹œ

---

## 10. ì°¸ê³  ìë£Œ

### ê´€ë ¨ íŒŒì¼
- [21ê°œ ê²€ì‚¬ ë¶„ì„](../analysis_initial_lab/scripts/analysis/extract_admission_day_labs.py)
- [98ê°œ ê²€ì‚¬ ë¶„ì„](../analysis_initial_lab/scripts/analysis/extract_initial_labs_complete.py)
- [ë¹„êµ ìŠ¤í¬ë¦½íŠ¸](./scripts/compare_analysis_methods.py)

### ë¬¸í—Œ
- Berkson, J. (1946). "Limitations of the application of fourfold table analysis to hospital data"
- HernÃ¡n, M. A., et al. (2004). "A structural approach to selection bias"

---

*ì‘ì„±ì¼: 2025-08-20*  
*í•µì‹¬ ë©”ì‹œì§€: "ì ì€ ê²ƒì´ ë•Œë¡œëŠ” ë” ë§ë‹¤, í•˜ì§€ë§Œ í¸í–¥ëœ ì ìŒì€ í•­ìƒ í‹€ë ¸ë‹¤"*