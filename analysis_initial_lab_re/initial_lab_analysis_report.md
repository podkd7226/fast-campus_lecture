# 📊 MIMIC-IV 초기 혈액검사 데이터 분석 보고서

## 📋 분석 개요

본 보고서는 MIMIC-IV 데이터셋에서 1,200개 입원 사례에 대한 초기 혈액검사 데이터 추출 및 분석 결과를 정리한 문서입니다.

### 분석 목적
- 입원 초기(Day -1, 0, +1) 혈액검사 데이터 추출
- 87개 주요 검사 항목의 데이터 가용성 평가
- itemid 기반 개별 처리로 데이터 무결성 보장

### 주요 특징
- **itemid 기반 처리**: 라벨 중복으로 인한 데이터 손실 방지
- **offset 정보 분리**: 메인 데이터와 시간 정보를 별도 관리
- **완전한 컬럼 보존**: 데이터가 없는 항목도 NaN 컬럼 유지

---

## 📋 분석 방법론

### "초기 혈액검사"의 정의

본 분석에서 초기 혈액검사는 다음과 같이 정의됩니다:

1. **시간적 기준**: 
   - 입원일 기준 -1일, 0일(당일), +1일
   - 우선순위: Day 0 > Day -1 > Day +1

2. **데이터 범위**: 
   - `d_labitems_inclusion.csv`에서 inclusion=1로 표시된 87개 항목
   - 모든 itemid를 개별적으로 처리

3. **판단 기준**: 
   - 각 itemid별로 가장 먼저 나타나는 값 사용
   - 수치형 데이터(valuenum) 우선 추출

4. **제외 기준**: 
   - inclusion=0인 검사 항목
   - 시간 윈도우(-1, 0, +1일) 외 데이터

---

## 🔍 데이터 추출 과정

### 1. 데이터 소스
분석 스크립트: `scripts/analysis/extract_initial_labs_clean.py:1-448`

| 파일명 | 설명 | 크기 |
|--------|------|------|
| `processed_data/core/admissions_sampled.csv` | 입원 정보 | 1,200건 |
| `processed_data/core/patients_sampled.csv` | 환자 정보 | 1,171명 |
| `processed_data/hosp/labevents_sampled.csv` | 검사 결과 | 2,825,084건 |
| `processed_data/hosp/d_labitems_inclusion.csv` | 검사 항목 정의 | 1,648개 (87개 inclusion=1) |

### 2. 추출 프로세스

#### 2.1 Inclusion=1 필터링
- 전체 검사: 2,825,084건
- Inclusion=1 필터링 후: 1,072,507건 (38.0%)

#### 2.2 시간 윈도우 적용
- Day 0 (입원 당일): 16,593건 (82.5%)
- Day -1 (입원 전일): 1,065건 (5.3%)
- Day +1 (입원 익일): 2,460건 (12.2%)
- **총 추출**: 20,118건

---

## 📊 분석 결과

### 1. 데이터 가용성

#### 1.1 전체 커버리지
- **검사가 있는 입원**: 1,155/1,200 (96.2%)
- **검사가 없는 입원**: 45/1,200 (3.8%)

#### 1.2 itemid별 데이터 현황
- **데이터가 있는 itemid**: 48/87 (55.2%)
- **데이터가 없는 itemid**: 39/87 (44.8%)

### 2. 주요 검사 항목 Top 10

| 순위 | 검사명 | itemid | 데이터 수 | 커버리지 |
|------|--------|--------|-----------|----------|
| 1 | Hematocrit | 51221 | 1,148 | 95.7% |
| 2 | Hemoglobin | 51222 | 1,143 | 95.2% |
| 3 | White Blood Cells | 51301 | 1,142 | 95.2% |
| 4 | RDW | 51277 | 1,141 | 95.1% |
| 5 | Creatinine | 50912 | 1,126 | 93.8% |
| 6 | Platelet Count | 51265 | 1,121 | 93.4% |
| 7 | Glucose | 50931 | 1,118 | 93.2% |
| 8 | Urea Nitrogen | 51006 | 1,118 | 93.2% |
| 9 | Sodium | 50983 | 1,095 | 91.2% |
| 10 | Chloride | 50902 | 1,093 | 91.1% |

### 3. 중복 라벨 분석

총 20개 라벨이 여러 itemid를 보유하고 있습니다:

#### 주요 중복 사례
- **Glucose**: 3개 itemid (50809, 50931, 52569)
- **Hematocrit**: 3개 itemid (50810, 51221, 52028)
- **Hemoglobin**: 3개 itemid (50811, 51222, 52030)
- **pH**: 3개 itemid (50820, 51094, 52033)
- **White Blood Cells**: 3개 itemid (51300, 51301, 52035)

이러한 중복은 서로 다른 측정 방법이나 장비를 반영하며, itemid별 개별 처리로 데이터 무결성을 보장합니다.

### 4. 데이터 출처 분포

시간 윈도우별 데이터 분포:
- **Day 0 (입원 당일)**: 82.5%
- **Day +1 (입원 익일)**: 12.2%
- **Day -1 (입원 전일)**: 5.3%

대부분의 검사가 입원 당일 시행되며, 일부는 익일 또는 전일 데이터를 사용합니다.

---

## 📁 생성된 파일

### 메인 데이터 파일

1. **labs_initial_wide.csv** (1,200 × 93)
   - 입원별 검사 결과 (Wide format)
   - 87개 검사 컬럼 + 6개 메타데이터 컬럼
   - Offset 정보 제외

2. **labs_initial_long.csv** (20,118 records)
   - 모든 검사 기록 (Long format)
   - 상세 검사 정보 포함

3. **labs_offset_info.csv** (20,118 records)
   - 각 검사의 day_offset 정보
   - 데이터 출처 추적 가능

### 메타데이터 파일

4. **lab_items_summary.csv** (87 items)
   - 각 검사 항목의 요약 정보
   - 데이터 가용성 및 커버리지

5. **labs_metadata.json**
   - 추출 프로세스 메타데이터
   - 통계 및 설정 정보

---

## ⚠️ 분석의 제한점

### 1. 데이터 제한
- **샘플 데이터**: 전체 MIMIC-IV가 아닌 1,200개 샘플만 분석
- **검사 항목 제한**: 87개 inclusion=1 항목만 포함
- **시간 제한**: ±1일 윈도우만 고려

### 2. 방법론적 제한
- **첫 번째 값 사용**: 동일 날짜 여러 검사 중 첫 번째만 선택
- **수치 데이터만**: valuenum이 있는 데이터만 추출
- **hadm_id 의존**: 일부 검사는 입원 ID가 없어 제외될 수 있음

### 3. 해석상 주의점
- **데이터 없음 ≠ 검사 미시행**: 샘플 데이터의 한계일 수 있음
- **중복 itemid**: 같은 검사의 다른 측정 방법일 수 있음
- **커버리지**: 실제 임상 환경과 다를 수 있음

---

## 💡 활용 방안

### 1. 머신러닝 모델링
- 96.2% 커버리지로 예측 모델 구축 가능
- 결측값 처리 전략 필요 (39개 완전 결측 컬럼)

### 2. 임상 연구
- 입원 초기 검사 패턴 분석
- 검사 시행률 및 우선순위 파악

### 3. 데이터 품질 개선
- 결측 패턴 분석을 통한 데이터 수집 개선
- 중복 itemid 통합 전략 수립

---

## 📝 결론

본 분석을 통해 MIMIC-IV 샘플 데이터에서 87개 주요 혈액검사 항목을 성공적으로 추출했습니다. 96.2%의 높은 커버리지를 보이며, itemid 기반 처리로 데이터 무결성을 보장했습니다. 

주요 성과:
- ✅ 모든 87개 inclusion=1 항목 처리
- ✅ 중복 라벨 문제 해결 (itemid별 개별 컬럼)
- ✅ Offset 정보 분리로 깔끔한 데이터 구조
- ✅ 완전한 추적 가능성 (메타데이터 포함)

이 데이터는 사망률 예측, 임상 패턴 분석 등 다양한 연구에 활용 가능합니다.

---

*분석 일시: 2025년 8월*  
*스크립트: `scripts/analysis/extract_initial_labs_clean.py`*  
*방법론: itemid 기반 개별 컬럼 처리*