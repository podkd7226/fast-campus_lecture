# Essential Dataset ëª¨ë¸ë§ ë¶„ì„ ë³´ê³ ì„œ

## ğŸ“Œ ê°œìš”

ë³¸ ë¬¸ì„œëŠ” MIMIC-IV Essential ë°ì´í„°ì…‹ì„ í™œìš©í•œ ì‚¬ë§ë¥  ë° ì…ì›ê¸°ê°„ ì˜ˆì¸¡ ëª¨ë¸ë§ ê²°ê³¼ë¥¼ ì¢…í•©ì ìœ¼ë¡œ ë¶„ì„í•©ë‹ˆë‹¤. ë°ì´í„° ëˆ„ì¶œ ë¬¸ì œì˜ ë°œê²¬ê³¼ í•´ê²°, ëª¨ë¸ ì„±ëŠ¥ ë¹„êµ, ê·¸ë¦¬ê³  ì˜ë£Œ ë°ì´í„° ëª¨ë¸ë§ì˜ íŠ¹ìˆ˜ì„±ì— ëŒ€í•œ í†µì°°ì„ ì œê³µí•©ë‹ˆë‹¤.

## ğŸ¯ ëª¨ë¸ë§ ëª©í‘œ

1. **ì‚¬ë§ ì˜ˆì¸¡**: 
   - ì „ì²´ ì‚¬ë§ (death_binary): ë³‘ì› ë‚´ì™¸ ì‚¬ë§ ëª¨ë‘ í¬í•¨
   - ë³‘ì› ë‚´ ì‚¬ë§ (hospital_death): ì…ì› ì¤‘ ì‚¬ë§ë§Œ í¬í•¨

2. **ì…ì›ê¸°ê°„ ì˜ˆì¸¡**:
   - ì—°ì†í˜• ë³€ìˆ˜ (los_days)ë¡œ íšŒê·€ ë¶„ì„

3. **ê²€ì¦ ë°©ë²•**:
   - ì‹œê°„ ê¸°ë°˜ ë¶„í•  (70:30)ë¡œ ì‹¤ì œ ìš´ì˜ í™˜ê²½ ì‹œë®¬ë ˆì´ì…˜

---

## ğŸ“Š ë°ì´í„°ì…‹ íŠ¹ì§•

### ê¸°ë³¸ ì •ë³´
- **ìƒ˜í”Œ ìˆ˜**: 1,200ê°œ (ìƒì¡´ 600, ë³‘ì› ë‚´ ì‚¬ë§ 300, ë³‘ì› ì™¸ ì‚¬ë§ 300)
- **ë³€ìˆ˜ ìˆ˜**: 23ê°œ (ì‹ë³„ì 2, ì‹œê°„ ì •ë³´ 4, íƒ€ê²Ÿ 5, íŠ¹ì„± 12)
- **í‰ê·  ê²°ì¸¡ë¥ **: ì•½ 6-8%

### ì£¼ìš” ë³€ìˆ˜ êµ¬ì„±

| ì¹´í…Œê³ ë¦¬ | ë³€ìˆ˜ | ì„¤ëª… |
|---------|------|------|
| **ì¸êµ¬í†µê³„** | age, gender, admission_type | ë‚˜ì´, ì„±ë³„, ì…ì› ìœ í˜• |
| **í˜ˆì•¡ê²€ì‚¬** | Hematocrit, Hemoglobin, Creatinine | ì í˜ˆêµ¬, í—¤ëª¨ê¸€ë¡œë¹ˆ, ì‹ ì¥ ê¸°ëŠ¥ |
| **ì „í•´ì§ˆ** | Sodium, Potassium | ë‚˜íŠ¸ë¥¨, ì¹¼ë¥¨ |
| **ê¸°íƒ€** | RDW, WBC, Urea Nitrogen, Glucose | ì í˜ˆêµ¬ ë¶„í¬, ë°±í˜ˆêµ¬, ìš”ì†Œì§ˆì†Œ, í˜ˆë‹¹ |

---

## âš ï¸ ë°ì´í„° ëˆ„ì¶œ Warning

> **ì£¼ì˜**: ì´ˆê¸° ëª¨ë¸ì—ì„œ `hospital_expire_flag`ê°€ íŠ¹ì„±ìœ¼ë¡œ í¬í•¨ë˜ì–´ AUROC 1.0ì´ ë‚˜ì™”ìŠµë‹ˆë‹¤.  
> ì´ëŠ” íƒ€ê²Ÿ ë³€ìˆ˜ì™€ ë™ì¼í•œ ì •ë³´ì˜€ìœ¼ë©°, ì œê±° í›„ ì •ìƒì ì¸ ì„±ëŠ¥(AUROC 0.81)ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

---

## ğŸ“ˆ ëª¨ë¸ ì„±ëŠ¥ ë¹„êµ

### ì „ì²´ ì‚¬ë§ ì˜ˆì¸¡ (AUROC)

| ëª¨ë¸ | AUROC | F1 Score | íŠ¹ì§• |
|------|-------|----------|------|
| **XGBoost** | 0.7895 | 0.7189 | ìµœê³  ì„±ëŠ¥, ë¹„ì„ í˜• íŒ¨í„´ í¬ì°© |
| **Logistic Regression** | 0.7794 | 0.7318 | ì•ˆì •ì , í•´ì„ ê°€ëŠ¥ |
| **Random Forest** | 0.7717 | 0.7158 | ì•™ìƒë¸” íš¨ê³¼ |

### ë³‘ì› ë‚´ ì‚¬ë§ ì˜ˆì¸¡ (AUROC)

| ëª¨ë¸ | AUROC | F1 Score | íŠ¹ì§• |
|------|-------|----------|------|
| **Random Forest** | 0.8145 | 0.4160 | ìµœê³  ì„±ëŠ¥ |
| **XGBoost** | 0.8124 | 0.4762 | F1 Score ìš°ìˆ˜ |
| **Logistic Regression** | 0.8011 | - | ì„ í˜• ëª¨ë¸, í•´ì„ ê°€ëŠ¥ |

### ì…ì›ê¸°ê°„ ì˜ˆì¸¡ (RÂ²)

| ëª¨ë¸ | MAE | RMSE | RÂ² | íŠ¹ì§• |
|------|-----|------|----|------|
| **Linear Regression** | 5.25 | 10.41 | 0.1310 | ê°€ì¥ ì•ˆì •ì  |
| **Random Forest** | 5.08 | 10.47 | 0.1205 | MAE ìµœì € |
| **XGBoost** | 5.39 | 11.32 | -0.0269 | ê³¼ì í•© ê°€ëŠ¥ì„± |

### ROC Curves ë¹„êµ

![ROC Curves ë¹„êµ](../../../figures/essential_tree_roc_comparison.png)
*ì „ì²´ ì‚¬ë§ ì˜ˆì¸¡ ROC Curves - Random Forest vs XGBoost*

![Baseline ROC - ì „ì²´ ì‚¬ë§](../../../figures/essential_baseline_roc_death.png)
*Logistic Regression ROC Curve - ì „ì²´ ì‚¬ë§ ì˜ˆì¸¡*

![Baseline ROC - ë³‘ì› ë‚´ ì‚¬ë§](../../../figures/essential_baseline_roc_hospital.png)
*Logistic Regression ROC Curve - ë³‘ì› ë‚´ ì‚¬ë§ ì˜ˆì¸¡*

---

## ğŸ” ì£¼ìš” ë°œê²¬ì‚¬í•­

### 1. Linear Regression ê³„ìˆ˜ì˜ ì—­ì„¤

![ì…ì›ê¸°ê°„ ì˜ˆì¸¡ íŠ¹ì„± ì¤‘ìš”ë„](../../../figures/essential_baseline_los_features.png)
*Linear Regression - ì…ì›ê¸°ê°„ ì˜ˆì¸¡ Top 15 ì¤‘ìš” íŠ¹ì„±*

#### ë°œê²¬ëœ íŒ¨í„´
```python
Creatinine coefficient: -0.45 (ìŒìˆ˜)
Potassium coefficient: -0.45 (ìŒìˆ˜)
```

#### ì˜í•™ì  ìƒì‹ê³¼ì˜ ëª¨ìˆœ
- **ê¸°ëŒ€**: Creatinine â†‘ â†’ ì‹ ì¥ ê¸°ëŠ¥ ì•…í™” â†’ ì…ì›ê¸°ê°„ â†‘
- **ì‹¤ì œ**: Creatinine â†‘ â†’ ì…ì›ê¸°ê°„ â†“ (ëª¨ë¸ ê²°ê³¼)

#### ì›ì¸ ë¶„ì„

1. **Simpson's Paradox**
   - ì „ì²´ ë°ì´í„°: ìŒì˜ ê´€ê³„
   - ê·¸ë£¹ë³„ ë¶„ì„: ë‹¤ë¥¸ íŒ¨í„´

2. **ìƒì¡´ í¸í–¥ (Survival Bias)**
   ```
   ë§¤ìš° ë†’ì€ Creatinine â†’ ë¹ ë¥¸ ì‚¬ë§ â†’ ì§§ì€ ì…ì›ê¸°ê°„
   ì¤‘ê°„ Creatinine â†’ ì¹˜ë£Œ ê°€ëŠ¥ â†’ ê¸´ ì…ì›ê¸°ê°„
   ```

3. **ë‹¤ì¤‘ê³µì„ ì„±**
   - admission_typeì´ ì¤‘ì¦ë„ë¥¼ ì´ë¯¸ ì„¤ëª…
   - Creatinineì˜ ë…ë¦½ì  íš¨ê³¼ê°€ ì™œê³¡ë¨

### 2. ì…ì› ìœ í˜•ì˜ ê°•ë ¥í•œ ì˜ˆì¸¡ë ¥

| ì…ì› ìœ í˜• | ê³„ìˆ˜ | ì˜í–¥ |
|-----------|------|------|
| EW EMER | +3.11 | ì…ì›ê¸°ê°„ 3.11ì¼ ì¦ê°€ |
| URGENT | +2.82 | ì…ì›ê¸°ê°„ 2.82ì¼ ì¦ê°€ |
| OBSERVATION | +2.12 | ì…ì›ê¸°ê°„ 2.12ì¼ ì¦ê°€ |

**í•´ì„**: ì‘ê¸‰ë„ê°€ ë†’ì„ìˆ˜ë¡ ì…ì›ê¸°ê°„ì´ ê¸¸ì–´ì§€ëŠ” ëª…í™•í•œ íŒ¨í„´

### ì‚¬ë§ ì˜ˆì¸¡ íŠ¹ì„± ì¤‘ìš”ë„

![ì‚¬ë§ ì˜ˆì¸¡ íŠ¹ì„± ì¤‘ìš”ë„](../../../figures/essential_baseline_death_features.png)
*Logistic Regression - ì‚¬ë§ ì˜ˆì¸¡ Top 15 ì¤‘ìš” íŠ¹ì„±*

### 3. ëª¨ë¸ë³„ íŠ¹ì§•

#### Logistic Regression
- **ì¥ì **: í•´ì„ ê°€ëŠ¥í•œ ê³„ìˆ˜, ì•ˆì •ì  ì„±ëŠ¥
- **ë‹¨ì **: ë¹„ì„ í˜• ê´€ê³„ í¬ì°© ëª»í•¨

#### Random Forest
- **ì¥ì **: ë¹„ì„ í˜• íŒ¨í„´ í¬ì°©, íŠ¹ì„± ì¤‘ìš”ë„ ì œê³µ
- **ë‹¨ì **: ê³¼ì í•© ìœ„í—˜, í•´ì„ ì–´ë ¤ì›€

#### XGBoost
- **ì¥ì **: ìµœê³  ì„±ëŠ¥ (ì‚¬ë§ ì˜ˆì¸¡)
- **ë‹¨ì **: ì…ì›ê¸°ê°„ ì˜ˆì¸¡ ì‹¤íŒ¨ (RÂ² < 0)

### 4. Tree ëª¨ë¸ íŠ¹ì„± ì¤‘ìš”ë„

#### Random Forest íŠ¹ì„± ì¤‘ìš”ë„

![RF ì‚¬ë§ ì˜ˆì¸¡ ì¤‘ìš”ë„](../../../figures/essential_rf_death_importance.png)
*Random Forest - ì‚¬ë§ ì˜ˆì¸¡ Top 15 ì¤‘ìš” íŠ¹ì„±*

![RF ì…ì›ê¸°ê°„ ì˜ˆì¸¡ ì¤‘ìš”ë„](../../../figures/essential_rf_los_importance.png)
*Random Forest - ì…ì›ê¸°ê°„ ì˜ˆì¸¡ Top 15 ì¤‘ìš” íŠ¹ì„±*

#### XGBoost íŠ¹ì„± ì¤‘ìš”ë„

![XGB ì‚¬ë§ ì˜ˆì¸¡ ì¤‘ìš”ë„](../../../figures/essential_xgb_death_importance.png)
*XGBoost - ì‚¬ë§ ì˜ˆì¸¡ Top 15 ì¤‘ìš” íŠ¹ì„±*

### 5. ì…ì›ê¸°ê°„ ì˜ˆì¸¡ ë¶„ì„

#### ì˜ˆì¸¡ vs ì‹¤ì œ ë¶„í¬

![ì…ì›ê¸°ê°„ ì˜ˆì¸¡ ì‚°ì ë„](../../../figures/essential_baseline_los_scatter.png)
*Linear Regression - ì…ì›ê¸°ê°„ ì˜ˆì¸¡ vs ì‹¤ì œ*

![Tree ëª¨ë¸ ì…ì›ê¸°ê°„ ë¹„êµ](../../../figures/essential_tree_los_comparison.png)
*Random Forest vs XGBoost - ì…ì›ê¸°ê°„ ì˜ˆì¸¡ ë¹„êµ*

#### ì”ì°¨ ë¶„ì„

![ì”ì°¨ ë¶„í¬](../../../figures/essential_baseline_los_residuals.png)
*Linear Regression - ì”ì°¨ ë¶„í¬ ë° Q-Q Plot*

---

## ğŸ’¡ ì˜ë£Œ ë°ì´í„° ëª¨ë¸ë§ì˜ íŠ¹ìˆ˜ì„±

### 1. ë¹„ì„ í˜• ê´€ê³„ì˜ ë³µì¡ì„±
- ê²€ì‚¬ ìˆ˜ì¹˜ì™€ ì˜ˆí›„ì˜ ê´€ê³„ê°€ Uìí˜• ë˜ëŠ” ì—­Uìí˜•
- Linear ëª¨ë¸ì˜ í•œê³„ ëª…í™•

### 2. ì‹œê°„ì  ìš”ì†Œì˜ ì¤‘ìš”ì„±
- ì‹œê°„ ê¸°ë°˜ ë¶„í• ì´ ëœë¤ ë¶„í• ë³´ë‹¤ í˜„ì‹¤ì 
- ì˜ë£Œ í”„ë¡œí† ì½œì˜ ì‹œê°„ì  ë³€í™” ë°˜ì˜

### 3. í´ë˜ìŠ¤ ë¶ˆê· í˜•
- ì›ë³¸ ë°ì´í„°: ì‚¬ë§ë¥  2.5%
- ìƒ˜í”Œë§ëœ ë°ì´í„°: ê· í˜• ë§ì¶¤ (50:50)
- ì‹¤ì œ ë°°í¬ ì‹œ ì¬ì¡°ì • í•„ìš”

---

## ğŸš€ ê°œì„  ë°©í–¥

### ë‹¨ê¸° ê°œì„ 
1. **íŠ¹ì„± ê³µí•™**
   - ê²€ì‚¬ ìˆ˜ì¹˜ì˜ ì •ìƒ/ë¹„ì •ìƒ ë²”ì£¼í™”
   - ìƒí˜¸ì‘ìš© í•­ ì¶”ê°€
   - ë¹„ì„ í˜• ë³€í™˜ (log, polynomial)

2. **í•˜ì´í¼íŒŒë¼ë¯¸í„° ìµœì í™”**
   - GridSearchCV í™œìš©
   - Cross-validationìœ¼ë¡œ ê³¼ì í•© ë°©ì§€

### ì¥ê¸° ê°œì„ 
1. **Extended/Comprehensive ë°ì´í„°ì…‹ í™œìš©**
   - ë” ë§ì€ ê²€ì‚¬ í•­ëª© í¬í•¨
   - ì˜ˆì¸¡ë ¥ í–¥ìƒ ê¸°ëŒ€

2. **ì•™ìƒë¸” ë°©ë²•**
   - ëª¨ë¸ ìŠ¤íƒœí‚¹
   - ê°€ì¤‘ í‰ê· 

3. **ì‹œê³„ì—´ ëª¨ë¸**
   - ì…ì› ì¤‘ ê²€ì‚¬ ë³€í™” ì¶”ì 
   - LSTM ë“± ìˆœí™˜ ì‹ ê²½ë§ í™œìš©

---

## ğŸ“‹ ì‹¤í–‰ ì½”ë“œ

### ë°ì´í„° ì¤€ë¹„
```python
# ë°ì´í„° ë¡œë“œ
df = pd.read_csv('data/essential/model_dataset_essential.csv')

# ì‹œê°„ ê¸°ë°˜ ë¶„í• 
df['admittime'] = pd.to_datetime(df['admittime'])
df = df.sort_values('admittime')
split_idx = int(len(df) * 0.7)
split_date = df.iloc[split_idx]['admittime']

train_df = df[df['admittime'] < split_date]
test_df = df[df['admittime'] >= split_date]
```

### ëª¨ë¸ í•™ìŠµ
```python
# íŠ¹ì„± ì •ì˜ (hospital_expire_flag ì œì™¸!)
feature_cols = [col for col in df.columns 
                if col not in id_cols + target_cols + time_cols + ['hospital_expire_flag']]

# Logistic Regression
lr = LogisticRegression(random_state=42, max_iter=1000)
lr.fit(X_train, y_train)

# Random Forest
rf = RandomForestClassifier(n_estimators=100, max_depth=10, random_state=42)
rf.fit(X_train, y_train)

# XGBoost
xgb = XGBClassifier(n_estimators=100, max_depth=6, random_state=42)
xgb.fit(X_train, y_train)
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

1. **ë°ì´í„° ëˆ„ì¶œ ë°©ì§€**
   - íƒ€ê²Ÿê³¼ ê´€ë ¨ëœ ë³€ìˆ˜ ì² ì €íˆ í™•ì¸
   - ë¯¸ë˜ ì •ë³´ê°€ íŠ¹ì„±ì— í¬í•¨ë˜ì§€ ì•Šë„ë¡ ì£¼ì˜

2. **ì„±ëŠ¥ í•´ì„**
   - RÂ² = 0.13ì€ ì…ì›ê¸°ê°„ ì˜ˆì¸¡ì´ ë§¤ìš° ì–´ë ¤ì›€ì„ ì‹œì‚¬
   - ë” ë§ì€ íŠ¹ì„±ì´ë‚˜ ë‹¤ë¥¸ ì ‘ê·¼ë²• í•„ìš”

3. **ì‹¤ì œ ë°°í¬**
   - ê· í˜• ìƒ˜í”Œë§ëœ ë°ì´í„°ë¡œ í•™ìŠµí•œ ëª¨ë¸ì€ ì¬ì¡°ì • í•„ìš”
   - ì‹¤ì œ ì‚¬ë§ë¥  2.5%ë¥¼ ë°˜ì˜í•œ ì„ê³„ê°’ ì¡°ì •

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [Essential Dataset ë¶„ì„](../datasets/Essential_Dataset_Analysis.md)
- [ëª¨ë¸ë§ ê°€ì´ë“œ](../guides/Modeling_Guide.md)
- [MIMIC-IV ë‚˜ì´ ê³„ì‚° ê°€ì´ë“œ](../guides/MIMIC_IV_Age_Calculation_Guide.md)

---

## ğŸ¯ ê²°ë¡ 

Essential ë°ì´í„°ì…‹ì„ í™œìš©í•œ ëª¨ë¸ë§ì—ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì£¼ìš” ì„±ê³¼ë¥¼ ë‹¬ì„±í–ˆìŠµë‹ˆë‹¤:

1. **ë°ì´í„° ëˆ„ì¶œ ë¬¸ì œ í•´ê²°**: hospital_expire_flag ì œê±°ë¡œ ì˜¬ë°”ë¥¸ í‰ê°€
2. **í•©ë¦¬ì ì¸ ì˜ˆì¸¡ ì„±ëŠ¥**: ì‚¬ë§ ì˜ˆì¸¡ AUROC ì•½ 0.78-0.81
3. **ì…ì›ê¸°ê°„ ì˜ˆì¸¡ì˜ ì–´ë ¤ì›€ í™•ì¸**: RÂ² < 0.15ë¡œ ê°œì„  í•„ìš”

ì˜ë£Œ ë°ì´í„°ì˜ ë³µì¡ì„±ê³¼ ë¹„ì„ í˜•ì„±ì„ ê³ ë ¤í•  ë•Œ, Tree ê¸°ë°˜ ëª¨ë¸ì´ ì „ë°˜ì ìœ¼ë¡œ ìš°ìˆ˜í•œ ì„±ëŠ¥ì„ ë³´ì˜€ìœ¼ë©°, íŠ¹íˆ XGBoostê°€ ì‚¬ë§ ì˜ˆì¸¡ì—ì„œ ê°€ì¥ ì¢‹ì€ ê²°ê³¼ë¥¼ ë‚˜íƒ€ëƒˆìŠµë‹ˆë‹¤. ì…ì›ê¸°ê°„ ì˜ˆì¸¡ì€ í˜„ì¬ íŠ¹ì„±ë§Œìœ¼ë¡œëŠ” í•œê³„ê°€ ìˆì–´, Extended ë˜ëŠ” Comprehensive ë°ì´í„°ì…‹ í™œìš©ì´ í•„ìš”í•©ë‹ˆë‹¤.

---

*ì‘ì„±ì¼: 2025-09-06*  
*ë¶„ì„ ë„êµ¬: Python 3.x, scikit-learn, XGBoost*  
*ë°ì´í„°: MIMIC-IV Essential Dataset (1,200 samples)*